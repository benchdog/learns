# coding: utf-8
import json
from collections import Iterable, Iterator
from kafka import KafkaProducer, KafkaConsumer
from kafka.errors import kafka_errors
import base64
import requests
import time
import threading
import logging
import pymysql
import os

def hik900_rev_check(message, viid_filter, tollgateid_filter):
    k = str(message.key, encoding="utf-8").split('_')[0]
    if k in viid_filter:
        v = json.loads(str(message.value.decode()))
        if 'MotorVehicleObjectList' in v['SubscribeNotificationListObject']['SubscribeNotificationObject'][0].keys():
            tollgateid = v['SubscribeNotificationListObject']['SubscribeNotificationObject'][0]['MotorVehicleObjectList']['MotorVehicleObject'][0]['TollgateID']
            if tollgateid in tollgateid_filter:
                print(tollgateid)
            else:
                print('kk--------kkï¼š' + str(tollgateid))

if __name__ == '__main__':
    bootstrap_servers = ['13.32.4.168:9092', '13.32.4.169:9092', '13.32.4.170:9092', '13.32.4.171:9092', '13.32.4.172:9092', '13.32.4.174:9092', '13.37.249.1:9092', '13.37.249.5:9092', '13.37.249.7:9092', '13.37.249.8:9092']
    kafka_meta = {'topic': "dahua_101", 'group_id': 'hik900_rev_check'}
    consumer = KafkaConsumer(kafka_meta['topic'], group_id=kafka_meta['group_id'], bootstrap_servers=bootstrap_servers, auto_offset_reset="latest", enable_auto_commit=True, auto_commit_interval_ms=5000)
    viid_filter = ['13010020205035164320']
    tollgateid_filter = ['13010000001210309455','13010000001210875037','13010000001210037938','13010000001210736730','13010000001210103782','13010000051215302626','13010000001210679934','13010000001210468754','13010000001210710969','13010000001210206972','13010000001210414295','13010000001210433424','13010000001210103769','13010000001210293701','13010000001210773547','13010000001210898824','13010000001210720034','13010000001210451206','13010000001210570398','13010000001210868950','13010000001210770226','13010000001210878990','13010000001210885943','13010000001210736372','13010000001210861164','13010000001210691242','13010000051217176693','13010000001210482958','13010000001210793550','13010000001210311048','13010000001210813493','13010000001210655389','13010000001210355663','13010000001210051014','13010000001210506689','13010000001210914972','13010000001210726381','13010000001210655830','13010000001210655120','13010000001210460463','13010000001210890158','13010000001210851748','13010000001210738027','13010000001210163203','13010000001210850952','13010000001210004433','13010000001210768049','13010000001210197756','13010000001210825373','13010000001210138704','13010000001210621490','13010000001210481849','13010000001210592756','13010000001210628194','13010000001210096568','13010000001210671201','13010000001210862824','13010000001210004037','13010000001210713032','13010000001210139174','13010000001210894380','13010000001210009621','13010000001210817449','13010000001210434921','13010000001210438950','13010000001210148503','13010000001210749065','13010000001210405838','13010000001210746111','13010000001210386299','13010000001210570621','13010000001210311887','13010000001210001096','13010000001210415491','13010000001210281354','13010000001210610731','13010000001210663644','13010000001210869681','13010000001210843136','13010000001210568713','13010000001210624813','13010000001210108421','13010000001210147055','13010000001210480701','13010000001210223782','13010000001210443949','13010000001210166416','13010000001210791196','13010000001210232299','13010000001210643442','13010000001210875935','13010000001210623535','13010000001210112831','13010000001210394588','13010000001210044463','13010000001210430292','13010000001210472628','13010000001210507767','13010000001210083882','13010000001210118591','13010000001210356527','13010000001210413011','13010000001210510345','13010000001210141678','13010000001210652428','13010000001210703628','13010000001210913942','13010000001210044699','13010000001210283956','13010000001210002980','13010000001210720248','13010000001210003007','13010000001210378353','13010000001210181600','13010000001210459146','13010000001210120303','13010000001210843154','13010000001210365418','13010000001210157829','13010000001210164238','13010000001210509940','13010000001210264847','13010000001210302076','13010000001210045976','13010000001210024535','13010000001210603486','13010000001210395389','13010000001210891647','13010000001210027913','13010000001210148208','13010000001210114177','13010000001210419497','13010000001210797684','13010000001210072887','13010000001210212008','13010000001210205518','13010000001210113303','13010000001210196490','13010000001210545716','13010000001210796818','13010000001210772245','13010000001210768830','13010000001210656382','13010000001210112195','13010000001210894066','13010000001210762098','13010000001210251407','13010000001210288491','13010000001210678722','13010000001210566733','13010000001210292596','13010000001210036489','13010000001210402809','13010000001210249629','13010000001210470026','13010000001210420141','13010000001210911453','13010000001210207326','13010000001210529285','13010000001210388868','13010000001210535258','13010000001210445480','13010000001210511618','13010000001210446615','13010000001210650733','13010000001210002923','13010000001210678430','13010000001210361549','13010000001210321284','13010000001210142537','13010000001210227530','13010000001210849130','13010000001210452981','13010000001210720213','13010000001210508000','13010000001210260307','13010000001210039587','13010000001210784382','13010000001210161830','13010000001210329490','13010000001210811052','13010000001210648492','13010000001210737600','13010000001210248152','13010000001210367596','13010000001210441495','13010000001210029930','13010000001210852587','13010000001210039760','13010000001210358689','13010000001210286229','13010000001210088699','13010000001210862052','13010000001210233396','13010000001210888749','13010000001210815393','13010000001210116494','13010000001210080126','13010000001210879529','13010000001210048647','13010000001210656072','13010000001210034602','13010000001210429927','13010000001210658089','13010000001210389498','13010000001210729397','13010000001210577416','13010000001210727237','13010000001210759355','13010000001210016987','13010000001210549394','13010000001210576257','13010000001210748777','13010000001210760264','13010000001210903028','13010000001210860128','13010000001210701344','13010000001210102224','13010000001210533129','13010000001210539008','13010000001210900651','13010000001210736656','13010000001210186490','13010000001210826980','13010000001210833146','13010000001210745626','13010000001210057008','13010000001210154013','13010000001210568406','13010000001210026541','13010000001210462865','13010000001210227086','13010000001210469246','13010000001210169719','13010000001210275394','13010000001210040098','13010000001210153464','13010000051218205491','13010000001210183531','13010000001210754737','13010000001210834591','13010000001210396133','13010000001210896082','13010000001210704166','13010000001210267313','13010000001210067617','13010000001210007057','13010000001210675133','13010000001210918132','13010000001210536864','13010000001210701217','13010000001210881773','13010000001210456461','13010000001210564752','13010000001210432519','13010000001210656962','13010000001210760469','13010000001210058060','13010000001210569968','13010000001210534768','13010000001210267600','13010000001210885095','13010000001210338508','13010000001210053133','13010000001210063766','13010000001210248246','13010000001210650799','13010000001210541304','13010000051211507450','13010000001210755587','13010000001210637409','13010000001210538473','13010000001210234438','13010000001210773119','13010000001210853040','13010000001210154769','13010000001210010059','13010000001210274573','13010000001210838232','13010000001210826603','13010000001210530755','13010000001210735863','13010000001210210777','13010000001210544053','13010000001210593201','13010000001210811591','13010000001210027566','13010000001210636150','13010000001210869201','13010000001210731014','13010000001210388071','13010000001210015054','13010000001210550339','13010000001210828036','13010000001210458121','13010000001210847665','13010000001210206497','13010000001210198172','13010000001210290566','13010000001210016799','13010000001210479329','13010000001210571814','13010000001210113735','13010000001210850291','13010000001210259894','13010000001210609568','13010000001210826806','13010000001210651452','13010000001210220768','13010000001210101293','13010000001210311912','13010000001210643579','13010000001210586630','13010000001210346641','13010000001210357678','13010000001210356579','13010000001210366564','13010000001210407571','13010000001210713774','13010000001210501998','13010000001210207427','13010000001210454554','13010000001210854712','13010000001210672336','13010000001210555530','13010000001210831004','13010000001210604281','13010000001210252221','13010000001210026206','13010000001210259801','13010000001210254471','13010000001210078886','13010000001210720119','13010000001210764370','13010000001210426543','13010000001210311963','13010000001210377504','13010000001210689593','13010000001210434478','13010000001210383990','13010000001210740713','13010000001210459282','13010000001210127955','13010000001210165960','13010000001210210505','13010000001210688674','13010000001210152752','13010000001210516347','13010000001210691046','13010000001210584570','13010000001210650308','13010000001210442967','13010000001210140260','13010000001210348344','13010000001210060180','13010000001210858336','13010000001210430189','13010000001210912322','13010000001210422555','13010000001210418158','13010000001210822951','13010000001210048965','13010000001210247043','13010000001210675406','13010000001210601144','13010000001210542178','13010000001210537302','13010000001210747125','13010000001210518787','13010000001210570502','13010000001210717655','13010000001210283072','13010000001210912993','13010000001210530402','13010000001210569411','13010000001210132757','13010000001210250260','13010000001210362507','13010000001210192367','13010000001210707438','13010000001210268030','13010000001210225728','13010000001210855368','13010000001210834023','13010000001210635687','13010000001210344350','13010000001210096228','13010000001210530202','13010000001210915716','13010000001210109569','13010000001210750559','13010000001210427849','13010000001210409770','13010000001210090484','13010000001210047057','13010000001210026687','13010000001210308046','13010000001210598261','13010000001210379105','13010000001210047522','13010000001210600824','13010000001210222723','13010000001210346397','13010000001210792851','13010000001210777048','13010000001210683458','13010000001210045522','13010000001210648879','13010000001210662276','13010000001210646793','13010000001210100020','13010000001210147940','13010000001210735170']
    for message in consumer:
        thread = threading.Thread(target=hik900_rev_check, args=(message, viid_filter, tollgateid_filter))
        thread.start()